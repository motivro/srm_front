<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>학습활동 || 팀별 괄호 맞추기 step2</title>
    <link rel="stylesheet" href="../../resources/css/common.css">
    <link rel="stylesheet" href="../../resources/css/swiper-bundle.min.css">
    <link rel="stylesheet" href="../../resources/css/content.css">
    <script src="../../resources/js/jquery-3.6.1.min.js"></script>
    <script src="../../resources/js/swiper-bundle.min.js"></script>
    <script src="../../resources/js/ui.js"></script>
</head>
<body>
    <div id="wrap">
        <!-- header -->
        <header id="header">
            <div class="hd_inner">
                <!-- <div id="ham_btn"><div class="line_box"></div></div> -->
                <div class="hd_left">
                    <h1 class="logo"><a href="/"><img src="../../resources/img/common/logo.svg" alt=""><span class="sound_only">소크라테스 교실</span></a></h1>
                    <div class="menu">
                        <div class="subject">국어</div>
                        <div class="class"><span class="grade_sta">3</span>학년 <span class="class_sta">3</span>반</div>
                        <div class="lesson">(<span class="date_sta">수</span>) <span class="lesson_sta">2,3</span>교시</div>
                    </div>
                </div>
                <div class="util is_login">
                    <!-- 로그링 -->
                    <div class="member_zone">
                        <div id="user_menu_btn" class="profile">
                            <div class="user_infor">
                                <span class="user_thumb"><img src="../../resources/img/common/user_thumb.svg" alt="유저프로필 이미지"></span>
                                <span class="user_name"><span class="name_sta">홍길동</span>님</span>
                            </div>
                            <i class="icon arrow arrow_d"></i>
                        </div>
                        <div class="menu_box">
                            <ul class="user_menu">
                                <li><a href="./login.html">로그인</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- //로그인 -->
                </div>
            </div>
        </header>
        <!-- //header -->

        <!-- container -->
        <div id="container" class="sub">
            <!-- intro -->
            <section class="content_top sub">
                <div class="inner inner_left">
                    <div class="card_wrap">
                        <ul class="card_list">
                            <li class="card_item ty1">
                                <div class="card_inner">
                                    <div class="item_infor">
                                        <div class="info_cate">
                                            <div class="cate_date">1주</div>
                                            <div class="cate_type group">조</div>
                                        </div>
                                        <div class="info_tit">
                                            <div class="tit">
                                                <span class="tit_cate">[M3-1-3]</span>
                                                <span class="slash">/</span>
                                                <span class="tit_name">조별 단어 설명하고 맞추기</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn_box">
                                        <a href="./m3_1_3_step1.html" class="btn btn_attend active"><i class="icon attend"></i><span class="btn_name">평가</span></a>
                                        <a href="./m3_1_3_step3.html" class="btn btn_result"><i class="icon result"></i><span class="btn_name">결과</span></a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="contents">
                <div class="inner">
                    <!-- profile_lnb -->
                    <nav id="lnb">
                        <div class="lnb_top" menu-cate="learning">
                            <div class="top_cont">
                                <div class="cate">learning</div>
                                <div class="tit">학습활동</div>
                            </div>
                        </div>
                        <div class="lnb_menu">
                            <ul class="menu_list">
                                <li class="menu_item"><a class="active" href="../../html/index.html">학습활동</a></li>
                                <li class="menu_item"><a href="#none">수업안내</a></li>
                                <li class="menu_item"><a href="#none">공지사항</a></li>
                                <li class="menu_item"><a href="#none">Q&A</a></li>
                                <li class="menu_item"><a href="#none">자료실</a></li>
                                <li class="menu_item"><a href="#none">나가기</a></li>
                            </ul>
                        </div>
                    </nav>
                    <!-- //profile_lnb -->

                    <!-- main_cont -->
                    <div id="main">
                        <div class="step_box">
                            <div class="step_tit"><span class="step_sta">Step 2.</span> 다음 단어 하나씩 조원에게 설명하고 맞추도록 하시오. 다 맞추면 종료버튼을 누르시오.</div>
                            <div class="target_box"><div class="exam_target">평가대상 : <span class="target_sta">1조</span></div></div>
                            <div class="step_cont oxquiz">
                                <div class="exam_timer_box">
                                    <div class="timer_inner">
                                        <div class="times min">00</div><span class="colon">:</span><div class="times sec">00</div>
                                    </div>
                                </div>
                                <div class="exam_box">
                                    <div class="exam_inner">
                                        <div class="exam"><span class="exam_sta hidden_txt">예술</span></div>
                                    </div>
                                </div>
                                <div class="exam_count">
                                    <span class="now_exam">1</span>
                                    <span class="slash">/</span>
                                    <span class="all_exam">5</span>
                                </div>
                                <div class="choice_box">
                                    <div class="answer_item answer_o"><span><i class="icon icon_o"></i></span></div>
                                    <div class="answer_item answer_x"><span><i class="icon icon_x"></i></span></div>
                                </div>
                            </div>
                        </div>
                        <div id="countDown" class="active">
                            <div class="countDown_inner">
                                <div class="counter">
                                    <div class="nums">
                                        <span class="in">3</span>
                                        <span>2</span>
                                        <span>1</span>
                                    </div>
                                    <div class="ready">Get Ready</div>
                                </div>
                                <div class="final">GO</div>
                            </div>
                        </div>
                    </div>
                    <!-- //main_cont -->
                </div>
            </section>
        </div>
        <!-- //container -->
    
        <div id="submitPop" class="ly_pop">
            <div class="ly_inner">
                <div class="modal_cont">
                    <div class="ly_hd">
                        <div class="tit">평가 완료</div>
                        <div class="ly_close_btn" onclick="closePopup('submitPop')"><span class="sound_only">닫기</span><i class="icon close"></i></div>
                    </div>
                    <div class="ly_bd">
                        <div class="bd_cont">
                            <div class="sub_tit view">
                                <div class="target_box"><div class="exam_target">평가대상 : <span class="target_sta">2조</span></div></div>
                            </div>
                            <div class="result_box">
                                <div class="box_inner ty2">
                                    <div class="result_info">
                                        <div class="info_txt">정답 : <span class="corr">3개</span></div>
                                    </div>
                                </div>
                                <div class="answer_list"></div>
                            </div>
                        </div>
                    </div>
                    <div class="ly_tbl">
                        <div class="btn_box">
                            <div class="btn btn_retry"><a href="./m3_1_3_step1.html">다시하기</a></div>
                            <div class="btn btn_list"><a href="../index.html">목록으로 이동</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="lyDim"></div>

        <!-- footer -->
        <footer id="footer" class="type_gray">
            <div class="ft_inner">
                <div class="left">
                    <h1 class="logo"><a href="/"><img src="../../resources/img/common/logo.svg" alt=""><span class="sound_only">소크라테스 교실</span></a></h1>
                    <div class="copyright">COPYRIGHT (C)2023 Technology-Based Active Learning., <br class="mo_only">All Rights Reserved.</div>
                </div>
                <div class="terms_box">
                    <ul>
                        <li><a href="#none">Terms of Service</a></li>
                        <li><a href="#none">Privacy</a></li>
                    </ul>
                </div>
            </div>
        </footer>
        <!-- //footer -->
    </div>

    <script>

        function closePopupOnDimClick2() {
            // var dim = $('#lyDim');
            // var openPopups = $('.ly_pop.open');
            // var body = $('body');

            // if (openPopups.length >= 0) {
            //     hidePopup(openPopups);
            //     hidePopup(dim);
            //     body.removeClass('no-scroll');
            // }

            // setTimeout(function() {
            //     // location.reload();
            // }, 1000); // 1000 밀리초 = 1초
        }


        const nums = $('.nums span');
        const counter = $('.counter');
        const finalMessage = $('.final');

        runAnimation();
        function runAnimation() {
            nums.each(function(idx) {
                const penultimate = nums.length - 1;
                $(this).on('animationend', function(e) {
                    if (e.originalEvent.animationName === 'goIn' && idx !== penultimate) {
                        $(this).removeClass('in').addClass('out');
                    } else if (e.originalEvent.animationName === 'goOut' && $(this).next().length) {
                        $(this).next().addClass('in');
                    } else {
                        counter.addClass('hide');
                        finalMessage.addClass('show');
                        setTimeout(function() {
                            $('#countDown').fadeOut().removeClass('active'); // 1초 뒤에 #countDown 요소 숨기기
                            $('.exam_timer_box').removeClass('non_time').addClass('active');; // 1초 뒤에 #countDown 요소 숨기기
                            countDownQuestion();
                            $('.exam_sta').removeClass('hidden_txt')
                        }, 1000); // 1000 밀리초 = 1초
                    }
                });
            });
        }

                    
        function countDownQuestion(){
            var question_data = [
                {question: '예술', answer:'O'},
                {question: '설명', answer:'O'},
                {question: '창조', answer:'O'},
                {question: '자기극복', answer:'O'},
                {question: '아티스트', answer:'O'},
            ];
            var currentQuestionIndex = 0;
            var correctAnswers = [];
            var wrongAnswers = [];
            var timerInterval = null;

            // 초기 문제 세팅
            $('.exam_sta').text(question_data[currentQuestionIndex].question);
            $('.all_exam').text(question_data.length);
            $('.now_exam').text(currentQuestionIndex + 1);

            // O, X 선택 이벤트 핸들러
            $('.answer_o, .answer_x').click(function() {
                // 사용자의 선택을 저장
                var selectedAnswer = $(this).hasClass('answer_o') ? 'O' : 'X';
                
                if(selectedAnswer === question_data[currentQuestionIndex].answer){
                    correctAnswers.push(question_data[currentQuestionIndex]);
                } else {
                    wrongAnswers.push(question_data[currentQuestionIndex]);
                }

                // 다음 문제로 넘어가기
                currentQuestionIndex++;
                if(currentQuestionIndex < question_data.length){
                    // 다음 문제 표시
                    $('.exam_sta').text(question_data[currentQuestionIndex].question);
                    $('.now_exam').text(currentQuestionIndex + 1);
                } else {
                    // 모든 문제를 마쳤을 때, 결과 출력
                    finishQuiz();
                }
            });

            // 타이머 시작 함수
            function startTimer_ui() {
                // 타이머 시간을 저장할 변수들을 초기화합니다.
                let minutes = 1;
                let seconds = 0;

                $('.min').text('01');
                $('.sec').text('00');

                // 타이머를 업데이트하는 함수입니다.
                function updateTimer() {
                    seconds--;
                    if (seconds < 0) {
                        seconds = 59;
                        minutes--;
                        if (minutes < 0) {
                            finishQuiz('time_out');
                            resetTimer();
                        }
                    }

                    // 타이머 값을 화면에 업데이트합니다.
                    $('.min').text(minutes.toString().padStart(2, '0'));
                    $('.sec').text(seconds.toString().padStart(2, '0'));
                }

                // 타이머를 시작하는 함수입니다.
                function startTimer() {
                    if (timerInterval === null) {
                        timerInterval = setInterval(updateTimer, 1000); // 1초마다 updateTimer 함수를 실행합니다.
                    }
                }

                startTimer();
            }

            // 타이머를 멈추는 함수입니다.
            function stopTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }

            // 타이머를 초기화하는 함수입니다.
            function resetTimer() {
                $('.min').text('01');
                $('.sec').text('00');
            }

            // 퀴즈 결과 출력 및 타이머 정지 함수
            function finishQuiz(time_sta) {
                stopTimer();
                $('.result_info .info_txt .corr').text(correctAnswers.length+' 개');
                $('#submitPop .answer_list span').remove();
                var answer_html = '';
                $.each(correctAnswers, function(index, item){
                    answer_html += '<span class="answer_item corr">'+item.question+'</span>';
                })
                if(time_sta == 'time_out'){
                    if( correctAnswers.length + wrongAnswers.length != question_data.length){
                        var question_data3 = [];
                        for (var i = 0; i < question_data.length; i++) {
                            var questionFoundInData2 = false;
                            for (var j = 0; j < correctAnswers.length; j++) {
                                if (question_data[i].question === correctAnswers[j].question) {
                                questionFoundInData2 = true;
                                break;
                                }
                            }
                            if (!questionFoundInData2) {
                                question_data3.push(question_data[i]);
                            }
                        }
                        $.each(question_data3, function(index, item){
                            answer_html += '<span class="answer_item err">'+item.question+'</span>';
                        })
                    }
                } else {
                    $.each(wrongAnswers, function(index, item){
                        answer_html += '<span class="answer_item err">'+item.question+'</span>';
                    })
                }

                $('#submitPop .answer_list').append(answer_html);
                openPopup('submitPop');
            }

            // 타이머 시작
            startTimer_ui();
        }

    </script>
    
</body>
</html>
