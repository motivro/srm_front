<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>학습활동 || 팀별 괄호 맞추기 step2</title>
    <link rel="stylesheet" href="../../resources/css/common.css">
    <link rel="stylesheet" href="../../resources/css/swiper-bundle.min.css">
    <link rel="stylesheet" href="../../resources/css/content.css">
    <script src="../../resources/js/jquery-3.6.1.min.js"></script>
    <script src="../../resources/js/swiper-bundle.min.js"></script>
    <script src="../../resources/js/ui.js"></script>
</head>
<body>
    <div id="wrap">
        <!-- header -->
        <header id="header">
            <div class="hd_inner">
                <!-- <div id="ham_btn"><div class="line_box"></div></div> -->
                <div class="hd_left">
                    <h1 class="logo"><a href="/"><img src="../../resources/img/common/logo.svg" alt=""><span class="sound_only">소크라테스 교실</span></a></h1>
                    <div class="menu">
                        <div class="subject">국어</div>
                        <div class="class"><span class="grade_sta">3</span>학년 <span class="class_sta">3</span>반</div>
                        <div class="lesson">(<span class="date_sta">수</span>) <span class="lesson_sta">2,3</span>교시</div>
                    </div>
                </div>
                <div class="util is_login">
                    <!-- 로그링 -->
                    <div class="member_zone">
                        <div id="user_menu_btn" class="profile">
                            <div class="user_infor">
                                <span class="user_thumb"><img src="../../resources/img/common/user_thumb.svg" alt="유저프로필 이미지"></span>
                                <span class="user_name"><span class="name_sta">홍길동</span>님</span>
                            </div>
                            <i class="icon arrow arrow_d"></i>
                        </div>
                        <div class="menu_box">
                            <ul class="user_menu">
                                <li><a href="./login.html">로그인</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- //로그인 -->
                </div>
            </div>
        </header>
        <!-- //header -->

        <!-- container -->
        <div id="container" class="sub">
            <!-- intro -->
            <section class="content_top sub">
                <div class="inner inner_left">
                    <div class="card_wrap">
                        <ul class="card_list">
                            <li class="card_item ty1">
                                <div class="card_inner">
                                    <div class="item_infor">
                                        <div class="info_cate">
                                            <div class="cate_date">1주</div>
                                            <div class="cate_type team">팀</div>
                                        </div>
                                        <div class="info_tit">
                                            <div class="tit"> 
                                                <span class="tit_cate">[M1-4-3]</span>
                                                <span class="slash">/</span>
                                                <span class="tit_name">팀별 괄호 맞추기</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn_box">
                                        <a href="./m1_4_3_step1.html" class="btn btn_attend active"><i class="icon attend"></i><span class="btn_name">참여</span></a>
                                        <a href="./m1_4_3_step3.html" class="btn btn_result"><i class="icon result"></i><span class="btn_name">결과</span></a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="contents">
                <div class="inner">
                    <!-- profile_lnb -->
                    <nav id="lnb">
                        <div class="lnb_top" menu-cate="learning">
                            <div class="top_cont">
                                <div class="cate">learning</div>
                                <div class="tit">학습활동</div>
                            </div>
                        </div>
                        <div class="lnb_menu">
                            <ul class="menu_list">
                                <li class="menu_item"><a class="active" href="../../html/index.html">학습활동</a></li>
                                <li class="menu_item"><a href="../../html/work_result/work_result_1.html">활동결과</a></li>
                                <li class="menu_item"><a href="#none">수업안내</a></li>
                                <li class="menu_item"><a href="#none">공지사항</a></li>
                                <li class="menu_item"><a href="#none">Q&A</a></li>
                                <li class="menu_item"><a href="#none">자료실</a></li>
                                <li class="menu_item"><a href="#none">나가기</a></li>
                            </ul>
                        </div>
                    </nav>
                    <!-- //profile_lnb -->

                    <!-- main_cont -->
                    <div id="main">
                        <div class="step_box">
                            <div class="step_tit"><span class="step_sta">Step 2.</span> 다음 본문을 잘 읽은 후, 5초뒤 빈칸에 알맞은 단어를 순서대로 맞춰주세요.</div>
                            <div class="step_cont">
                                <div class="intervalTimes">00</div>
                                <div class="exam_box type_txt">
                                    <div class="exam_inner">
                                        <p class="txt" id="blankExam">
                                        이제까지 나는 우리 동네의 예술적 분위기에 대하여 긴 설명을 했다. 물론 끝없는 자기 극복과 한없는 자기 단련으로 고통의 창조 작업을 하고 있는 예술인들이 많이 모인다는 이야기도 했다.하지만 내가 하고자 하는 ‘예술가’ 이야기는 지금부터가 시작이다. 나는 내게 감동을 준 두 명의 예술가들에 관해 말하려고 여태까지 긴 서두를 펼치고 있었던 셈이다. 이 두 명의 예술가들이 만드는 작품은 어떤 것이고, 또 그들은 어떤 생활을 하고 있는지에 대해서는 지금부터의 이야기가 말해 줄 것이다. 그 전에 한 가지 미리 말해 두는 바이지만, 이 두 사람의 예술가들을 보고 싶다면 언제라도 우리 동네에 오면 된다. 그들은 이 동네의 한가운데에서 매일같이 성실하고 끈질기게 자신의 진지한 ‘예술’에 몰두해 있으니까.
                                        </p>
                                    </div>
                                </div>
                                <div id="countDown" class="active">
                                    <div class="countDown_inner">
                                        <div class="counter">
                                            <div class="nums">
                                                <span class="in">3</span>
                                                <span>2</span>
                                                <span>1</span>
                                            </div>
                                            <div class="ready">Get Ready</div>
                                        </div>
                                        <div class="final">GO</div>
                                    </div>
                                </div>
                                <div class="exam_timer_box">
                                    <div class="timer_inner">
                                        <div class="times min">00</div><span class="colon">:</span><div class="times sec">00</div>
                                        <!-- <div class="times min">00</div><span class="colon">:</span><div class="times sec">00</div><span class="colon">:</span><div class="times milsec">00</div> -->
                                    </div>
                                </div>
                                <div class="btn_box">
                                    <button type="button" id="submitBtn" class="btn exam_fin">제출하기</button>
                                    <button type="button" id="blankView" class="btn read_txt" disabled>본문 다시보기(<span class="intervalTimes2">05</span>초)</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- //main_cont -->
                </div>
            </section>
        </div>
        <!-- //container -->
    
        <div id="sample2" class="ly_pop">
            <div class="ly_inner">
                <div class="modal_cont">
                    <div class="ly_hd">
                        <div class="tit">평가 완료</div>
                        <div class="ly_close_btn" onclick="closePopup('sample2')"><span class="sound_only">닫기</span><i class="icon close"></i></div>
                    </div>
                    <div class="ly_bd">
                        <div class="bd_cont">
                            <div class="sub_tit">
                                <div class="tit">Step 3</div>
                                <div class="desc">평가가 완료되었습니다.</div>
                            </div>
                            <div class="result_box">
                                <div class="box_inner">
                                    <div class="timer">
                                        <div><span class="min">12</span>분</div>
                                        <div><span class="sec">23</span>초</div>
                                    </div>

                                    <div class="btn_box_justify lp_type2">
                                        <div class="btn_box">
                                            <div class="read_txt">
                                                <div>현재 팀별 평균 : </div>
                                                <div class="timer">
                                                    <div><span class="min">12</span>분</div>
                                                    <div><span class="sec">23</span>초</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="btn_box top_filter">
                                            <div class="btn_refresh small"><i class="icon refresh"></i></div>
                                        </div>
                                    </div>

                                </div>
                                
                            </div>
                        </div>
                        <div class="btn_box">
                            <div class="btn btn_list"><a href="../index.html">목록으로 이동</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="errPop" class="ly_pop ty2">
            <div class="ly_inner">
                <div class="modal_cont">
                    <div class="ly_bd">
                        <div class="msg_box">
                            <div class="msg_tit">제출 불가</div>
                            <div class="msg_desc">틀린 답안이 있습니다.</div>
                        </div>
                        <div class="btn_box"><div class="btn btn_confirm" onclick="closePopup('errPop')"><a href="#none">확인</a></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="lyDim" onclick="closePopupOnDimClick()"></div>

        <!-- footer -->
        <footer id="footer" class="type_gray">
            <div class="ft_inner">
                <div class="left">
                    <h1 class="logo"><a href="/"><img src="../../resources/img/common/logo.svg" alt=""><span class="sound_only">소크라테스 교실</span></a></h1>
                    <div class="copyright">COPYRIGHT (C)2023 Technology-Based Active Learning., <br class="mo_only">All Rights Reserved.</div>
                </div>
                <div class="terms_box">
                    <ul>
                        <li><a href="#none">Terms of Service</a></li>
                        <li><a href="#none">Privacy</a></li>
                    </ul>
                </div>
            </div>
        </footer>
        <!-- //footer -->
    </div>

    <script>
        $(document).ready(function() {
            var nums = $('.nums span');
            var counter = $('.counter');
            var finalMessage = $('.final');
        
            var words = ["예술적 분위기", "자기 단련", "예술가", "끈질기게", "몰두"];
            var originalContent = $("#blankExam").text();
            var isStarted = false;
            var timerId;
            var userInput = {}; // 사용자의 입력 값을 저장할 객체

            runAnimation();

            function runAnimation() {
                nums.each(function(idx) {
                    var penultimate = nums.length - 1;
                    $(this).on('animationend', function(e) {
                        if (e.originalEvent.animationName === 'goIn' && idx !== penultimate) {
                            $(this).removeClass('in').addClass('out');
                        } else if (e.originalEvent.animationName === 'goOut' && $(this).next().length) {
                            $(this).next().addClass('in');
                        } else {
                            counter.addClass('hide');
                            finalMessage.addClass('show');
                            setTimeout(function() {
                                $('#countDown').fadeOut().removeClass('active'); // 1초 뒤에 #countDown 요소 숨기기
                                $('.exam_timer_box').removeClass('non_time').addClass('active');; // 1초 뒤에 #countDown 요소 숨기기
                                intervalTimes();
                                chgInp ();
                            }, 1000); // 1000 밀리초 = 1초
                            
                        }
                    });
                });
            }

            // chgInp 함수 정의
            function chgInp() {
                timerId = setTimeout(function () {
                    var newContent = originalContent;
                    for (var i = 0; i < words.length; i++) {
                        var targetWord = words[i];
                        var width = targetWord.length == 2 ? targetWord.length * 20 : targetWord.length * 15;
                        var inputValue = userInput[targetWord] || ""; // 기존 입력 값이 있으면 가져오고, 없으면 빈 문자열로 초기화
                        var inputElement = "<input type='text' class='input_blank' style='width:"+width +"px' data-word='" + targetWord + "' value='" + inputValue + "' />";
                        newContent = newContent.replace(targetWord, inputElement);
                    }
                    $("#blankExam").html(newContent);
                    $("#blankView").prop("disabled", false);
                    startTimer_ui();
                }, 5000);
            }

            // 인풋 필드의 값이 변경될 때마다 저장하는 이벤트 핸들러
            $(document).on("change", ".input_blank", function() {
                var targetWord = $(this).data("word");
                var inputVal = $(this).val();
                userInput[targetWord] = inputVal;
            });

            $("#blankView").on("click", function () {
                intervalTimes();
                clearTimeout(timerId);
                $("#blankExam").html(originalContent);
                $(".input_blank").each(function () {
                    var targetWord = $(this).data("word");
                    var inputVal = userInput[targetWord] || ""; // 기존 입력 값이 있으면 가져오고, 없으면 빈 문자열로 초기화
                    $(this).val(inputVal); // 인풋 필드에 기존 입력 값을 설정합니다.
                    $(this).replaceWith(targetWord);
                });
                $("#blankView").prop("disabled", true);
                setTimeout(function () {
                    var newContent = originalContent; // 원래 본문을 유지한 상태에서
                    for (var i = 0; i < words.length; i++) {
                        var targetWord = words[i];
                        var width = targetWord.length == 2 ? targetWord.length * 20 : targetWord.length * 15;
                        var inputValue = userInput[targetWord] || ""; // 기존 입력 값이 있으면 가져오고, 없으면 빈 문자열로 초기화
                        var inputElement = "<input type='text' class='input_blank' style='width:"+width +"px' data-word='" + targetWord + "' value='" + inputValue + "' />";
                        newContent = newContent.replace(targetWord, inputElement);
                    }
                    $("#blankExam").html(newContent); // 입력 필드가 있는 상태로 다시 변경합니다.
                    $(".input_blank").prop("disabled", false);
                    $("#blankView").prop("disabled", false);
                }, 5000);
            });

            $('.exam_fin').on('click', function(){
                // console.log(222);
            });

            $("#submitBtn").on("click", function () {
                var inputs = $(".input_blank");
                var allCorrect = true;

                inputs.each(function () {
                    var userInput = $(this).val();
                    var targetWord = $(this).data("word");

                    if (userInput !== targetWord) {
                        allCorrect = false;
                        return false;
                    }
                });

                if (allCorrect) {
                    isStarted = false;
                    clearTimeout(timerId);
                    openPopup('sample2');
                    $("#blankExam").html(originalContent);
                    $(".input_blank").each(function () {
                        var targetWord = $(this).data("word");
                        $(this).replaceWith(targetWord);
                    });
                    console.log(111)
                } else {
                    openPopup('errPop');
                    console.log(222)
                }
            });
            
        });

        function intervalTimes (){
            let count = 4;
            const intervalId = setInterval(() => {
                $('.intervalTimes2').text(count.toString().padStart(2, '0'));
                count--;
            }, 1000);

            setTimeout(() => {
                $('.intervalTimes2').text('05');
                clearInterval(intervalId);
            }, 5000);
        }
        
        const popupEvent = new CustomEvent('popupOpened', { detail: 'sample2' });

        function startTimer_ui() {
            // 타이머 시간을 저장할 변수들을 초기화합니다.
            let hours = 0;
            let minutes = 0;
            let seconds = 0;
            let timerInterval = null;

            // 타이머를 업데이트하는 함수입니다.
            function updateTimer() {
                seconds++;
                if (seconds >= 60) {
                    seconds = 0;
                    minutes++;
                    if (minutes >= 60) {
                        minutes = 0;
                        hours++;
                    }
                }
                // 타이머 값을 화면에 업데이트합니다.
                $('.hr').text(hours.toString().padStart(2, '0'));
                $('.min').text(minutes.toString().padStart(2, '0'));
                $('.sec').text(seconds.toString().padStart(2, '0'));
            }

            // 타이머를 시작하는 함수입니다.
            function startTimer() {
                if (timerInterval === null) {
                    timerInterval = setInterval(updateTimer, 1000); // 1초마다 updateTimer 함수를 실행합니다.
                }
            }

            // 팝업이 열리면 실행되는 이벤트 리스너를 추가합니다.
            document.addEventListener('popupOpened', function(event) {
                const popupName = event.detail;
                // 현재 날짜와 시간을 가져옵니다.
                const now = new Date();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const date = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes2 = String(now.getMinutes()).padStart(2, '0');
                const seconds2 = String(now.getSeconds()).padStart(2, '0');

                // 타이머를 멈추고, 팝업에 현재 타이머 시간을 표시합니다.
                stopTimer();
                $('#sample1 .now_stop_time').html(minutes.toString().padStart(2, '0') + '분 ' + seconds.toString().padStart(2, '0') + '초');
                console.log(`팝업 ${popupName}이(가) 열렸습니다.`, minutes.toString().padStart(2, '0'), seconds.toString().padStart(2, '0'));
            });

            // 타이머를 멈추는 함수입니다.
            function stopTimer() {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            // 타이머를 초기화하는 함수입니다.
            function resetTimer() {
                hours = 0;
                minutes = 0;
                seconds = 0;
                $('.hr').text('00');
                $('.min').text('00');
                $('.sec').text('00');
            }

            // 타이머를 시작합니다.
            startTimer();
        }

    </script>
</body>
</html>
